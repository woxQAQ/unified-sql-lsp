name: "Semantic error detection tests"
description: "SQL semantic error detection (DIAG-003, DIAG-004, DIAG-005)"

database:
  dialect: "mysql"
  connection_string: "mysql://test_user:test_password@127.0.0.1:3307/test_db"
  schemas:
    - "../../../fixtures/schema/mysql/01_create_tables.sql"
  data:
    - "../../../fixtures/data/mysql/02_insert_basic_data.sql"

tests:
  # Semantic errors (NOT YET IMPLEMENTED - DIAG-003, DIAG-004, DIAG-005)
  - name: "unknown table"
    description: "Should detect non-existent table"
    sql: "SELECT * FROM nonexistent_table|"
    expect_diagnostics:
      error_count: 1
      error_codes: ["SEMANTIC-001"]

  - name: "unknown column"
    description: "Should detect non-existent column"
    sql: "SELECT nonexistent_column FROM users|"
    expect_diagnostics:
      error_count: 1
      error_codes: ["SEMANTIC-002"]

  - name: "ambiguous column"
    description: "Should detect ambiguous column reference"
    sql: "SELECT * FROM users u JOIN orders o ON u.id = o.user_id WHERE id = 1|"
    expect_diagnostics:
      error_count: 1
      error_codes: ["SEMANTIC-003"]

  - name: "column from wrong table"
    description: "Should detect column from unrelated table"
    sql: "SELECT u.order_date FROM users u|"
    expect_diagnostics:
      error_count: 1
      error_codes: ["SEMANTIC-002"]

  # Type mismatches
  - name: "type mismatch in comparison"
    description: "Should detect type mismatch"
    sql: "SELECT * FROM users WHERE username = 123|"
    expect_diagnostics:
      error_count: 1
      error_codes: ["SEMANTIC-004"]

  - name: "invalid aggregate usage"
    description: "Should detect invalid aggregate function usage"
    sql: "SELECT id, COUNT(*) FROM users|"
    expect_diagnostics:
      error_count: 1
      error_codes: ["SEMANTIC-005"]

  # Invalid function usage
  - name: "unknown function"
    description: "Should detect non-existent function"
    sql: "SELECT UNKNOWN_FUNCTION(id) FROM users|"
    expect_diagnostics:
      error_count: 1
      error_codes: ["SEMANTIC-006"]

  - name: "wrong function arguments"
    description: "Should detect incorrect number of arguments"
    sql: "SELECT CONCAT() FROM users|"
    expect_diagnostics:
      error_count: 1
      error_codes: ["SEMANTIC-007"]

  # JOIN errors
  - name: "missing ON clause"
    description: "Should detect missing ON clause for JOIN"
    sql: "SELECT * FROM users JOIN orders|"
    expect_diagnostics:
      error_count: 1
      error_codes: ["SYNTAX-001"]

  - name: "invalid join column"
    description: "Should detect invalid column in JOIN ON"
    sql: "SELECT * FROM users u JOIN orders o ON u.invalid_col = o.id|"
    expect_diagnostics:
      error_count: 1
      error_codes: ["SEMANTIC-002"]
